<%- include('../partials/header') %>

<div class="container mt-4">
  <div class="row mb-4">
    <div class="col-md-12">
      <div class="d-flex justify-content-between align-items-center">
        <h2 class="text-primary-accent">My Dashboard</h2>
        <div>
          <a href="/users/profile/edit" class="btn btn-gradient-primary">
            <i class="fas fa-edit"></i> Edit Profile
          </a>
        </div>
      </div>
    </div>
  </div>

  <!-- User Welcome Card -->
  <div class="card bg-dark-surface text-white mb-4 border-0 shadow-soft">
    <div class="card-body d-flex">
      <% if (user.profilePhoto || user.profilePicture) { %>
      <img
        src="/uploads/profile/<%= user.profilePhoto || user.profilePicture %>"
        alt="<%= user.name %>"
        class="rounded-circle me-3 border border-2 border-accent"
        style="width: 100px; height: 100px; object-fit: cover"
      />
      <% } else { %>
      <div
        class="rounded-circle bg-gradient-accent d-flex align-items-center justify-content-center me-3"
        style="width: 100px; height: 100px"
      >
        <span class="text-white" style="font-size: 2rem"
          ><%= user.name.charAt(0).toUpperCase() %></span
        >
      </div>
      <% } %>
      <div>
        <h3 class="card-title text-accent">Welcome back, <%= user.name %></h3>
        <p class="card-text">
          <%= user.bio ? user.bio.substring(0, 150) + (user.bio.length > 150 ?
          '...' : '') : 'Tell us about yourself by editing your profile!' %>
        </p>
        <div class="d-flex mt-2">
          <a href="/moments/new" class="btn btn-gradient-primary btn-sm me-2">
            <i class="fas fa-camera"></i> Share Moment
          </a>
          <a href="/events" class="btn btn-outline-accent btn-sm">
            <i class="fas fa-search"></i> Explore Events
          </a>
        </div>
      </div>
    </div>
  </div>

  <!-- Stats Cards Row -->
  <div class="row mb-4">
    <div class="col-md-4 mb-3">
      <div class="card h-100 bg-gradient-primary border-0 shadow-soft">
        <div class="card-body">
          <div class="d-flex justify-content-between">
            <div>
              <h5 class="text-white">Upcoming Events</h5>
              <h2 class="text-white mb-0"><%= totalUpcoming || 0 %></h2>
            </div>
            <div
              class="rounded-circle bg-white bg-opacity-25 d-flex align-items-center justify-content-center"
              style="width: 50px; height: 50px"
            >
              <i class="fas fa-ticket-alt text-white fa-lg"></i>
            </div>
          </div>
          <a href="/users/events" class="btn btn-sm btn-light mt-3">View All</a>
        </div>
      </div>
    </div>

    <div class="col-md-4 mb-3">
      <div class="card h-100 bg-gradient-accent border-0 shadow-soft">
        <div class="card-body">
          <div class="d-flex justify-content-between">
            <div>
              <h5 class="text-white">Past Events</h5>
              <h2 class="text-white mb-0"><%= totalPast || 0 %></h2>
            </div>
            <div
              class="rounded-circle bg-white bg-opacity-25 d-flex align-items-center justify-content-center"
              style="width: 50px; height: 50px"
            >
              <i class="fas fa-history text-white fa-lg"></i>
            </div>
          </div>
          <a href="/users/events?filter=past" class="btn btn-sm btn-light mt-3"
            >View History</a
          >
        </div>
      </div>
    </div>

    <div class="col-md-4 mb-3">
      <div class="card h-100 bg-dark-input text-light border-0 shadow-soft">
        <div class="card-body">
          <div class="d-flex justify-content-between">
            <div>
              <h5 class="text-accent">Followed Artists</h5>
              <h2 class="text-accent mb-0">
                <%= followedArtists ? followedArtists.length : 0 %>
              </h2>
            </div>
            <div
              class="rounded-circle bg-accent bg-opacity-25 d-flex align-items-center justify-content-center"
              style="width: 50px; height: 50px"
            >
              <i class="fas fa-star text-accent fa-lg"></i>
            </div>
          </div>
          <a href="/users/following" class="btn btn-sm btn-outline-accent mt-3"
            >View Artists</a
          >
        </div>
      </div>
    </div>
  </div>

  <div class="row">
    <div class="col-md-8">
      <!-- Spotify Integration -->
      <div class="col-md-12 mb-4">
        <div class="spotify-section" id="spotify-section">
          <div class="spotify-header">
            <img src="/images/spotify-logo.png" alt="Spotify Logo" class="spotify-logo">
            <h3 class="spotify-title">Spotify Integration</h3>
          </div>
          
          <!-- Connect button (shown when not connected) -->
          <button id="spotify-connect" class="spotify-connect-btn">
            <i class="fab fa-spotify"></i> Connect to Spotify
          </button>
          
          <!-- Now Playing Section (hidden until connected) -->
          <div id="now-playing" class="now-playing" style="display: none;">
            <img id="album-art" src="/images/album/album-art.jpeg" alt="Album Art" class="album-art">
            <div class="track-info">
              <h4 id="track-name" class="track-name">Not Playing</h4>
              <p id="artist-name" class="artist-name">No artist</p>
              <div class="progress-container">
                <div id="progress-bar" class="progress-bar" style="width: 0%"></div>
              </div>
              <div class="time-display">
                <span id="current-time">0:00</span>
                <span id="total-time">0:00</span>
              </div>
            </div>
          </div>
          
          <!-- Player Controls (hidden until connected) -->
          <div id="player-controls" class="player-controls" style="display: none;">
            <button id="prev-button" class="control-button">
              <i class="fas fa-step-backward"></i>
            </button>
            <button id="play-pause-button" class="control-button play-pause-button">
              <i class="fas fa-play"></i>
            </button>
            <button id="next-button" class="control-button">
              <i class="fas fa-step-forward"></i>
            </button>
          </div>
          
          <!-- Playlists (hidden until connected) -->
          <div id="playlist-container" class="playlists-container" style="display: none;">
            <h4 class="playlists-title">Your Playlists</h4>
            <select id="playlists-dropdown" class="playlists-dropdown">
              <option value="">Select a playlist</option>
            </select>
            <div id="playlist-tracks" class="playlist-tracks"></div>
          </div>
        </div>
      </div>

      <!-- Upcoming Events Section -->
      <div class="card bg-dark-surface mb-4 border-0 shadow-soft">
        <div class="card-header border-bottom border-accent">
          <h4 class="text-accent mb-0">
            <i class="fas fa-calendar"></i> My Upcoming Events
          </h4>
        </div>
        <div class="card-body">
          <% if (upcomingEvents && upcomingEvents.length > 0) { %>
          <div class="table-responsive">
            <table class="table table-dark table-hover border-0">
              <thead>
                <tr>
                  <th>Event</th>
                  <th>Date</th>
                  <th>Location</th>
                  <th>Actions</th>
                </tr>
              </thead>
              <tbody>
                <% upcomingEvents.forEach(event => { %>
                <tr>
                  <td><strong><%= event.name %></strong></td>
                  <td>
                    <%= new Date(event.date).toLocaleDateString('en-US', {
                    month: 'short', day: 'numeric', year: 'numeric' }) %>
                  </td>
                  <td><%= event.location %></td>
                  <td>
                    <a
                      href="/events/<%= event.id %>"
                      class="btn btn-sm btn-outline-accent"
                    >
                      <i class="fas fa-info-circle"></i> Details
                    </a>
                  </td>
                </tr>
                <% }); %>
              </tbody>
            </table>
          </div>
          <% if (totalUpcoming > 3) { %>
          <div class="text-end mt-3">
            <a href="/users/events" class="btn btn-sm btn-outline-accent"
              >View all <%= totalUpcoming %> events</a
            >
          </div>
          <% } %> <% } else { %>
          <div class="text-center py-5">
            <div class="mb-3">
              <i class="fas fa-calendar-times fa-3x text-muted"></i>
            </div>
            <h5 class="text-muted">No upcoming events</h5>
            <p class="text-muted">You don't have any events booked yet.</p>
            <a href="/events" class="btn btn-gradient-primary">Browse Events</a>
          </div>
          <% } %>
        </div>
      </div>

      <!-- Recent Moments Section -->
      <div class="card bg-dark-surface border-0 shadow-soft">
        <div
          class="card-header border-bottom border-accent d-flex justify-content-between align-items-center"
        >
          <h4 class="text-accent mb-0">
            <i class="fas fa-camera"></i> Recent Moments
          </h4>
          <a href="/moments/new" class="btn btn-sm btn-outline-accent">
            <i class="fas fa-plus"></i> Share New
          </a>
        </div>
        <div class="card-body">
          <div class="text-center py-5">
            <div class="mb-3">
              <i class="fas fa-images fa-3x text-muted"></i>
            </div>
            <h5 class="text-muted">No moments shared yet</h5>
            <p class="text-muted">
              Share your concert photos and videos with the community!
            </p>
            <a href="/moments/new" class="btn btn-gradient-primary mt-2"
              >Share Your First Moment</a
            >
          </div>
        </div>
      </div>
    </div>

    <div class="col-md-4">
      <!-- Followed Artists -->
      <div class="card bg-dark-surface mb-4 border-0 shadow-soft">
        <div class="card-header border-bottom border-accent">
          <h4 class="text-accent mb-0">
            <i class="fas fa-star"></i> Artists You Follow
          </h4>
        </div>
        <div class="card-body">
          <% if (followedArtists && followedArtists.length > 0) { %>
          <ul class="list-group list-group-flush bg-transparent">
            <% followedArtists.forEach(artist => { %>
            <li
              class="list-group-item bg-transparent border-bottom border-accent-soft text-light d-flex align-items-center"
            >
              <% if (artist.picture) { %>
              <img
                src="/uploads/artists/<%= artist.picture %>"
                class="rounded-circle me-3"
                width="40"
                height="40"
                style="object-fit: cover"
              />
              <% } else { %>
              <div
                class="rounded-circle bg-gradient-accent d-flex align-items-center justify-content-center me-3"
                style="width: 40px; height: 40px"
              >
                <span class="text-white" style="font-size: 1.2rem"
                  ><%= artist.name.charAt(0).toUpperCase() %></span
                >
              </div>
              <% } %>
              <div class="flex-grow-1">
                <a
                  href="/artists/<%= artist.id %>"
                  class="text-accent text-decoration-none"
                  ><%= artist.name %></a
                >
                <p class="text-muted mb-0 small">
                  <%= artist.genre || "Artist" %>
                </p>
              </div>
            </li>
            <% }) %>
          </ul>
          <div class="text-center mt-3">
            <a href="/users/following" class="btn btn-sm btn-outline-accent"
              >View All</a
            >
          </div>
          <% } else { %>
          <div class="text-center py-4">
            <div class="mb-3">
              <i class="fas fa-star fa-3x text-muted"></i>
            </div>
            <h5 class="text-muted">Not following any artists yet</h5>
            <p class="text-muted">
              Follow your favorite artists to stay updated on their events.
            </p>
            <a href="/artists" class="btn btn-gradient-primary mt-2"
              >Discover Artists</a
            >
          </div>
          <% } %>
        </div>
      </div>

      <!-- Quick Links -->
      <div class="card bg-dark-surface border-0 shadow-soft">
        <div class="card-header border-bottom border-accent">
          <h4 class="text-accent mb-0">
            <i class="fas fa-link"></i> Quick Links
          </h4>
        </div>
        <div class="card-body">
          <div class="list-group list-group-flush bg-transparent">
            <a
              href="/events"
              class="list-group-item bg-transparent border-bottom border-accent-soft text-accent d-flex justify-content-between align-items-center"
            >
              <div><i class="fas fa-calendar me-3"></i> Browse Events</div>
              <i class="fas fa-chevron-right text-muted"></i>
            </a>
            <a
              href="/artists"
              class="list-group-item bg-transparent border-bottom border-accent-soft text-accent d-flex justify-content-between align-items-center"
            >
              <div><i class="fas fa-music me-3"></i> Discover Artists</div>
              <i class="fas fa-chevron-right text-muted"></i>
            </a>
            <a
              href="/moments/gallery"
              class="list-group-item bg-transparent border-bottom border-accent-soft text-accent d-flex justify-content-between align-items-center"
            >
              <div><i class="fas fa-images me-3"></i> View Gallery</div>
              <i class="fas fa-chevron-right text-muted"></i>
            </a>
            <a
              href="/users/tickets"
              class="list-group-item bg-transparent border-bottom border-accent-soft text-accent d-flex justify-content-between align-items-center"
            >
              <div><i class="fas fa-ticket-alt me-3"></i> My Tickets</div>
              <i class="fas fa-chevron-right text-muted"></i>
            </a>
            <a
              href="/users/profile/edit"
              class="list-group-item bg-transparent text-accent d-flex justify-content-between align-items-center"
            >
              <div><i class="fas fa-user-cog me-3"></i> Account Settings</div>
              <i class="fas fa-chevron-right text-muted"></i>
            </a>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<style>
  /* Professional Color Palette */
  :root {
    --color-primary: #4f46e5;
    --color-primary-dark: #4338ca;
    --color-accent: #8b5cf6;
    --color-accent-light: #a78bfa;
    --color-success: #10b981;
    --color-error: #ef4444;
    --color-dark-surface: #1e1b4b;
    --color-dark-input: #1e1e2d;
    --color-border-dark: #2d2b42;
  }

  /* Background Colors */
  .bg-dark-surface {
    background-color: var(--color-dark-surface);
  }

  .bg-dark-input {
    background-color: var(--color-dark-input);
  }

  /* Text Colors */
  .text-primary-accent {
    color: var(--color-primary);
  }

  .text-accent {
    color: var(--color-accent-light);
  }

  .text-success {
    color: var(--color-success);
  }

  .text-error {
    color: var(--color-error);
  }

  /* Borders */
  .border-accent {
    border-color: var(--color-accent) !important;
  }

  .border-accent-soft {
    border-color: rgba(139, 92, 246, 0.2) !important;
  }

  .border-dark {
    border-color: var(--color-border-dark) !important;
  }

  /* Gradients */
  .bg-gradient-primary {
    background: linear-gradient(
      135deg,
      var(--color-primary),
      var(--color-accent)
    );
  }

  .bg-gradient-accent {
    background: linear-gradient(
      135deg,
      var(--color-accent),
      var(--color-primary-dark)
    );
  }

  /* Buttons */
  .btn-gradient-primary {
    background: linear-gradient(
      135deg,
      var(--color-primary),
      var(--color-accent)
    );
    border: none;
    color: white;
    transition: all 0.3s ease;
  }

  .btn-gradient-primary:hover {
    background: linear-gradient(
      135deg,
      var(--color-accent),
      var(--color-primary)
    );
    transform: translateY(-1px);
    color: white;
  }

  .btn-outline-accent {
    color: var(--color-accent-light);
    border-color: var(--color-accent);
    transition: all 0.3s ease;
  }

  .btn-outline-accent:hover {
    background-color: var(--color-accent);
    color: white;
    transform: translateY(-1px);
  }

  /* Cards & Shadows */
  .card {
    border-radius: 12px;
    overflow: hidden;
    transition: transform 0.3s ease;
  }

  .shadow-soft {
    box-shadow: 0 4px 20px rgba(79, 70, 229, 0.1) !important;
  }

  /* Tables */
  .table {
    --bs-table-bg: transparent;
    --bs-table-color: #fff;
  }

  .table-dark {
    --bs-table-hover-bg: rgba(139, 92, 246, 0.1);
  }

  /* List Groups */
  .list-group-item {
    transition: all 0.2s ease;
  }

  .list-group-item:hover {
    background-color: rgba(139, 92, 246, 0.1) !important;
  }
</style>

<%- include('../partials/footer') %>

<!-- Add the Spotify JS -->
<link rel="stylesheet" href="/css/spotify.css">
<script src="/js/spotify-integration.js"></script>
</body>
</html>
